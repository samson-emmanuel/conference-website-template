{% extends "base.html" %}
{% block content %}
<section class="gallery">
    <h2>Explore Gallery</h2>
    
    <!-- Upload Form -->
    <form action="{{ url_for('gallery') }}" method="POST" enctype="multipart/form-data" class="upload-form" id="upload-form">
        <input type="file" name="image" id="file-input" accept="image/*" style="display: none;" onchange="document.getElementById('upload-form').submit();">
        <button type="button" class="custom-button" onclick="document.getElementById('file-input').click();">Upload Photo</button>
    </form>  
    <br>

    <!-- Gallery Grid -->
    <div class="gallery-grid" id="gallery-container">
        {% for image in images %}
        <div class="gallery-item" onclick="openModal('{{ image }}')">
            <img src="{{ image }}" alt="Event Image" class="gallery-image">
        </div>
        {% endfor %}
    </div>

    <!-- Load More Button -->
    <button id="load-more" onclick="loadMoreImages()" class="custom-button">Load More</button>
</section>

<!-- Image Modal -->
<div id="imageModal" class="modal" onclick="closeModal()">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage" alt="Image Preview">
</div>

<script>
    let currentStart = 12; // Starting point for loading more images
    const limit = 12; // Number of images to load per request

    async function loadMoreImages() {
        try {
            const response = await fetch(`/load-more-images?start=${currentStart}&limit=${limit}`);
            const newImages = await response.json();

            if (newImages.length === 0) {
                document.getElementById("load-more").style.display = "none"; // Hide button if no more images
                return;
            }

            const galleryContainer = document.getElementById("gallery-container");
            newImages.forEach(filename => {
                const galleryItem = document.createElement("div");
                galleryItem.className = "gallery-item";
                galleryItem.setAttribute("onclick", `openModal('${filename}')`);

                const img = document.createElement("img");
                img.src = filename;
                img.alt = "Event Image";
                img.className = "gallery-image";

                galleryItem.appendChild(img);
                galleryContainer.appendChild(galleryItem);
            });

            currentStart += limit; // Update the starting point for the next load
        } catch (error) {
            console.error("Error loading more images:", error);
        }
    }

    function openModal(imageSrc) {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        
        modal.style.display = "block"; // Show the modal
        modalImg.src = imageSrc; // Set the source of the modal image
    }

    function closeModal() {
        const modal = document.getElementById("imageModal");
        modal.style.display = "none"; // Hide the modal
    }

    document.addEventListener("DOMContentLoaded", () => {
        if ({{ images|length }} < 12) {
            document.getElementById("load-more").style.display = "none";
        }
    });
</script>


{% endblock %}
